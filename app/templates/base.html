<!doctype html>




<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>

        <script>

        function httpGet(theUrl)
        {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
            xmlHttp.send( null );
            return xmlHttp.responseText;
        }

        function clickedUpdate(e, a)
        {

                window.location.assign('/update/' + a);

        }

        function clickedDelete(e, a)
        {
            if(!confirm('Are you sure?' + a)) {
                e.preventDefault();
            }

            else{
                window.location.assign('/delete/' + a);
            }
        }

        // Based on https://www.mxcursos.com/blog/como-consultar-cep-utilizando-javascript/
        $(document).ready(function() {
                "use strict";

                const cep =  $("input[name = postalCode]");

           $("input[name = postalCode]").on('blur', function(e) {

                var validacep = /^[0-9]{8}$/;


                const value = cep.val().replace(/[^0-9]+/, '');

                if(validacep.test(cep.val())) {

                const url = 'https://cdn.apicep.com/file/apicep/'+ value.substring(0, 5) + '-' + value.substring(5, 8) + '.json';

                fetch(url)
                .then((response) => {
                  if (response.ok) {
                    return response.json();
                  }
                  throw new Error('Something went wrong');
                })
              .then( json => {


                  if( json.address ) {
                    $("input[name = street]").val(json.address);
                    $("input[name = city]").val(json.city);
                    $("input[name = state]").val(json.state);
                    $("input[name = country]").val('Brazil');
                  }


              })
              .catch((error) =>
              {

                    alert('Postal code not found, try again');
                    $("input[name = street]").val('');
                    $("input[name = city]").val('');
                    $("input[name = state]").val('');
                    $("input[name = country]").val('');
                    $("input[name = number]").val('');
                    $("input[name = postalCode]").val('');
              });



              }
              else
              {
                alert('Postal code must be XXXXXXXX')
                $("input[name = postalCode]").val('');
                $("input[name = street]").val('');
                $("input[name = city]").val('');
                $("input[name = state]").val('');
                $("input[name = country]").val('');
                $("input[name = number]").val('');
                $("input[name = postalCode]").val('');
              }

           });


        })


        </script>

      <link rel="stylesheet" type="text/css" href= "{{ url_for('static',filename='styles/custom.css') }}"/>

      <link href="https://fonts.googleapis.com/css2?family=Reenie+Beanie&display=swap" rel="stylesheet">
      {% if title %}
      <title>{{ title }} - API TEST - Contacts</title>
      {% else %}
      <title>Welcome to API TEST - Contacts</title>
      {% endif %}
    </head>
    <body>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

            <ul class="menu">
              <li><a href="/index" class="menuItem">Home</a></li>
              <li><a href="/list" class="menuItem">List Contacts</a></li>
              <li><a href="/search" class="menuItem">Search Contact</a></li>
              <li><a href="/add" class="menuItem">Add Contact</a></li>
            </ul>

        <hr>
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <ul>
            {% for message in messages %}
            <li>{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </body>
</html>